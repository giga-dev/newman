<script src="../components/webcomponentsjs/webcomponents.js"></script>

<link rel="import" href="routes.html">
<link rel="import" href="../components/core-ajax/core-ajax.html">

<polymer-element name="suite-view" attributes="url active" active>
    <template>
        <link rel="stylesheet" href="../components/bootstrap/dist/css/bootstrap.css">
        <core-ajax id="reload" auto url="{{url}}" handleAs="json" on-core-response="{{ajaxResponse}}" withCredentials="true"></core-ajax>
        <core-ajax id="update" handleAs="json" method="POST" withCredentials="true" content="text/plain" headers='{"Accept": "application/json","Content-Type": "text/plain" }'></core-ajax>
        <div class="content" flex>
            <h2>Suite</h2>
            <div class="table-responsive" style="padding-top: 5px; margin-bottom: -14px">
                <table class="table table-hover table-striped table-bordered table-condensed">
                    <thead>
                    <tr>
                        <th width="18%">Name</th>
                        <th width="18%">Id</th>
                        <th width="24%">Custom variables</th>
                        <th width="40%">Criteria</th>
                    </tr>
                    </thead>
                    <tbody>

                        <tr class="{{{'hidden' : !suite.id, 'visible' : suite.id} | tokenList}}">
                            <td>{{suite.name}}</td>
                            <td>{{suite.id}}</td>
                            <td>
                                <textarea id="customvariablestextarea" style="height: 450px; width:100%; font-size: inherit; background-color: inherit" readonly>{{suite.customVariables}}</textarea>
                            </td>
                            <td>
                                <textarea id="criteriatextarea" style="height: 450px; width:100%; font-size: inherit; background-color: inherit" readonly>{{suite.displayedCriteria}}</textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <span style="">
                <button type="button" id="editsuitebutton" class='btn btn-default edit-suite-button' on-click="{{editSuite}}">Edit</button>
                <button type="button" id="savesuitebutton" class='btn btn-default save-suite-button disabled' on-click="{{saveSuite}}">Save</button>
            </span>
        </div>
    </template>
    <script src="../components/moment/moment.js"></script>
    <script>
    Polymer({
      applyAuthorStyles: true,
      suite: [],

        ajaxResponse: function(event,resp){
            this.suite = resp.response;
        },
        reload : function(){
            this.$.reload.go();
        },
        editSuite: function(event,resp){
            var saveButton = this.getSaveButton();
            var editButton = this.getEditButton();
            editButton.classList.add('disabled');
            saveButton.classList.remove('disabled');

            var criteriaTextArea = this.getCriteriaTextArea();
            criteriaTextArea.removeAttribute('readonly');

            var customVariablesTextArea = this.getCustomVariablesTextArea();
            customVariablesTextArea.removeAttribute('readonly');
        },
        saveSuite: function(event,resp){
            var saveButton = this.getSaveButton();
            var editButton = this.getEditButton();
            saveButton.classList.add('disabled')
            editButton.classList.remove('disabled')
            var criteriaTextArea = this.getCriteriaTextArea();
            var customVariablesTextArea = this.getCustomVariablesTextArea();

            var updatedSuiteCriteria = criteriaTextArea.value;
            console.info( '>>> save, updatedSuiteCriteria=', updatedSuiteCriteria );
            criteriaTextArea.setAttribute('readonly', '');

            var updatedSuiteCustomVariables = customVariablesTextArea.value;
            console.info( '>>> save, updatedSuiteCustomVariables=', updatedSuiteCustomVariables );
            customVariablesTextArea.setAttribute('readonly', '');

            this.suite.criteria=updatedSuiteCriteria;
            this.suite.customVariables=updatedSuiteCustomVariables;
            this.$.update.url=this.url;

            this.$.update.body=JSON.stringify(this.suite);
//            this.$.update.url='api/newman/updatesuite';// + "/" + this.suite;
            this.$.update.go();

            criteriaTextArea.value=updatedSuiteCriteria;
        },
        createSuiteJSON: function(){
          return JSON.stringify( this.suite );
        },
        getSaveButton: function(){
            return this.$.savesuitebutton;
        },
        getEditButton: function(){
            return this.$.editsuitebutton;
        },
        getCriteriaTextArea: function(){
            return this.$.criteriatextarea;
        },
        getCustomVariablesTextArea: function(){
            return this.$.customvariablestextarea;
        },
        activeChanged: function(oldValue, newValue){
           console.info("suite-view activeChanged to ", newValue);
      }
    });
    </script>
</polymer-element>