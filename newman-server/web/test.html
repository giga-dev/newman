<script src="../components/webcomponentsjs/webcomponents.js"></script>

<link rel="import" href="routes.html">
<link rel="import" href="../components/core-ajax/core-ajax.html">

<polymer-element name="test-info" attributes="url data">
    <template>
        <style>
            ul.unindent {
            list-style-position: inside;
            padding-left:0;
            }
        </style>
        <link rel="stylesheet" href="../components/bootstrap/dist/css/bootstrap.css">
        <core-ajax auto url="{{url}}" handleAs="json" on-core-response="{{ajaxResponse}}"
                   withCredentials="true"></core-ajax>
        <h3>Details for test {{data.name}}</h3>
        <dl class="dl-horizontal">
            <dt>status</dt>
            <dd>
                <test-status test="{{data}}"></test-status>
            </dd>
            <dt>id</dt>
            <dd>{{data.id}}</dd>
            <template bind if="{{data.jobId}}">
                <dt>jobId</dt>
                <dd><a href="{{urlFor('job', {id: data.jobId})}}">{{data.jobId}}</a></dd>
            </template>
            <dt>arguments</dt>
            <dd>{{data.arguments}}</dd>
            <dt>test type</dt>
            <dd>{{data.testType}}</dd>
            <dt>timeout</dt>
            <dd>{{data.timeout | formatTimeout}}</dd>

            <dt>errorMessage</dt>
            <dd>{{data.errorMessage}}</dd>
            <dt>logs</dt>
            <dd>
                <template bind if="{{data.logs}}">
                    <ul class="unindent">
                        <template repeat="{{key, index in data.logs | filterKeys}}">
                            <li><a href="{{data.logs[key]}}" target="_blank">{{key}}</a> <a href="{{data.logs[key]}}?download=true">download</a></li>
                        </template>
                    </ul>
                </template>
            </dd>

            <dt>Running Tests</dt>
            <dd>{{data.runningTests}}</dd>
            <dt>assignedAgent</dt>
            <dd>{{data.assignedAgent}}</dd>
            <dt>startTime</dt>
            <dd>{{data.startTime | formatDate}}</dd>
            <dt>endTime</dt>
            <dd>{{data.endTime | formatDate}}</dd>
            <dt>scheduledAt</dt>
            <dd>{{data.scheduledAt |formatDate}}</dd>
        </dl>

    </template>
    <script src="../components/moment/moment.js"></script>

    <script>
    Polymer({
      applyAuthorStyles: true,
      data: null,
      ajaxResponse: function(event,resp){
           this.data = resp.response;
      },
      formatDate: function(date){
            if(!date){
                return date;
            }
           return moment(new Date(date)).fromNow();
      },
      formatTotalTime: function(item){
            if(!item.endTime || !item.startTime){
                return null;
            }
            return moment.duration(item.endTime - item.startTime).humanize();
      },
      formatTimeout: function(timeout){
            if(!timeout){
                return null;
            }
            return moment.duration(timeout).asSeconds() + " seconds";
      }

    });

    </script>
</polymer-element>