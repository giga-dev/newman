<link rel="import" href="routes.html">
<link rel="import" href="../components/core-ajax/core-ajax.html">
<link rel="import" href="shared-mixin.html">

<polymer-element name="test-info" attributes="url data">
    <template>
        <style>
            ul.unindent {
            list-style-position: inside;
            padding-left:0;
            }
        </style>
        <link rel="stylesheet" href="../components/bootstrap/dist/css/bootstrap.css">
        <core-ajax auto url="{{url}}" handleAs="json" on-core-response="{{ajaxResponse}}"
                   withCredentials="true"></core-ajax>
        <h3>Details for test {{data.name}}</h3>
        <dl class="dl-horizontal">
            <dt>status</dt>
            <dd>
                <test-status test="{{data}}"></test-status>
            </dd>
            <dt>id</dt>
            <dd>{{data.id}}</dd>
            <template bind if="{{data.jobId}}">
                <dt>jobId</dt>
                <dd><a href="{{urlFor('job', {id: data.jobId, filterByStatus: 'ALL'})}}">{{data.jobId}}</a></dd>
            </template>
            <dt>arguments</dt>
            <dd><test-arguments test="{{data}}"></test-arguments></dd>
            <dt>test type</dt>
            <dd>{{data.testType}}</dd>
            <dt>timeout</dt>
            <dd>{{data.timeout | formatTimeout}}</dd>

            <dt>errorMessage</dt>
            <dd>{{data.errorMessage}}</dd>
            <dt>logs</dt>
            <dd>
                <template bind if="{{data.logs}}">
                    <ul class="unindent">
                        <template repeat="{{key, index in data.logs | filterKeys | sortKeysByLength}}">
                            <li><a href="{{data.logs[key]}}" target="_blank">{{key}}</a> &nbsp;&nbsp; <a href="{{data.logs[key]}}?download=true">[Download]</a></li>
                        </template>
                    </ul>
                </template>
            </dd>

            <dt>Running Tests</dt>
            <dd>{{data.runningTests}}</dd>
            <dt>assignedAgent</dt>
            <dd>{{data.assignedAgent}}</dd>
            <dt>startTime</dt>
            <dd>{{data.startTime | formatDate}}</dd>
            <dt>endTime</dt>
            <dd>{{data.endTime | formatDate}}</dd>
            <dt>scheduledAt</dt>
            <dd>{{data.scheduledAt |formatDate}}</dd>
            <dt>test score</dt>
            <dd>{{data.testScore}}</dd>
            <dt>history stats</dt>
            <dd>{{data.historyStats}}</dd>
            <dt>history</dt>
            <template bind if="{{data.id}}">
                <dd><a href="{{urlFor('test-history', {id: data.id } )}}">{{data.id}}</a></dd>
            </template>
        </dl>

    </template>

    <script>
        Polymer(Polymer.mixin({
      applyAuthorStyles: true,
      data: null,
      ajaxResponse: function(event,resp){
           this.data = resp.response;
      },
      formatArguments: function(test){
          if( test ) {
              var arguments = test.arguments;
              if( arguments ) {
                  return arguments.join(" ");
              }
          }
          return '';
      }
        }, window.sharedMixin));
    </script>
</polymer-element>